% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/security.R
\name{api_csrf}
\alias{api_csrf}
\title{Apply CSRF Protection to a plumber2 API}
\usage{
api_csrf(api, secure = TRUE)
}
\arguments{
\item{api}{a plumber2 API object}

\item{secure}{if \code{TRUE}, sets the CSRF cookie to "__Host-csrf" and marks the cookie as
secure. If false, uses "csrf".}
}
\description{
Installs CSRF middleware on a plumber2 API using the double-submit cookie pattern.
}
\details{
When installed:
\itemize{
\item Any \code{form} element inside \link{template} automatically
include a CSRF token.
\item If working in JavaScript contexts, the \code{csrf_token()} helper is also accessible inside templates.
}

Middleware behaviour:
\itemize{
\item On \strong{safe} methods (\code{GET}, \code{HEAD}, \code{OPTIONS}), if the CSRF cookie is missing,
a new token is generated and set as a cookie.
\item On \strong{unsafe} methods (\code{POST}, \code{PUT}, \code{DELETE}, \code{PATCH}), the request is
rejected with \strong{403} unless a token provided via the \code{X-CSRF-Token} header
or a \code{csrf_token} field in the parsed request body matches the CSRF cookie.
}
}
\examples{
#* @plumber
function(api) {
  api |>
       api_csrf(secure = FALSE)
}

}
