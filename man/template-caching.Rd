% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/template_cache.R
\name{cache}
\alias{cache}
\alias{clear_cache}
\alias{invalidate_cache}
\alias{invalidate_cache_here}
\title{Cache a renderd partial within a template}
\usage{
cache(name, vary = NULL, ...)

clear_cache()

invalidate_cache(tpl, name, vary = NULL, fragment = NULL)

invalidate_cache_here(name, vary = NULL, fragment = NULL)
}
\arguments{
\item{name}{unique name for the cached partial template}

\item{vary}{values that should change when the cached output should change. This is used to construct the cache key.}

\item{...}{tag content to render and cache}

\item{tpl}{a template function created by \code{\link[=template]{template()}}.}

\item{fragment}{optional fragment name for targetting cached fragments}
}
\description{
\code{cache()} memoises a portion of HTML output within a freshwater template.
The contents are computed once per unique cache key, and reused in subsequent calls.
This avoids repeat evaluation of expensive or stable HTML trees.

\code{clear_cache()} removes all memoised templates from freshwater's cache store.

\code{invalidate_cache()} removes a single cached entry identified by \code{name}, and optionally via
\code{vary} and fragment values. Note that the \code{invalidate_cache} arguments
must match those in the original \code{cache} call, as they are used to construct
the cache key.

\code{invalidate_cache_here()} is the in-template version of \code{invalidate_cache}. It uses
the current template execution context to allow users to forcibly regenerate caches
inside the template function.
}
\details{
Caches may be freely nested, as each cache is scoped to the template
context it is executed in.

Caching occurs a small overhead for first-time usage, but is faster in proceeding calls.

Note: invalidation affects future renders only. Calling this within the \code{cache()} block
that is being targeted will not result in an invalidation of the cache.
}
\examples{
# Caching
nav <- template(user, {
  div(
    cache(
      "nav",
      vary = user$id,
      ul(
        li("Home"),
        li("Profile"),
        if (user$is_admin) li("Admin")
      )
    )
  )
})
nav(list(id = 1, is_admin = TRUE))

# Nested Caches
dashboard <- template(page = list(), stats = list(), recent = list(), {
    cache(
        name = "page",
        vary = page$updated_at,
        div(
            h1("Dashboard"),
            cache(
                name = "stats",
                 vary = stats$updated_at,
                div(p(stats$count))
            ),
            cache(
                name = "recent",
                vary = recent$updated_at,
                div(recent)
            )
        )
    )
})
dashboard()

# Invalidate the current cache
# during rendering

page <- template(user, {
  div(
    cache(
      name = "content",
      vary = user$id,
      {
        if (user$refresh) {
          invalidate_cache_here(
            name = "content",
            vary = user$id
          )
        }
        p("Hello ", user$id)
      }
    )
  )
})

page(list(id = 1, refresh = FALSE))

page(list(id = 1, refresh = TRUE))

}
\seealso{
\link{template}
}
